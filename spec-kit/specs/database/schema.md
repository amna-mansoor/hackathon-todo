# Database Schema Specification

**Component**: Database (Neon Serverless PostgreSQL), Backend ORM (SQLModel)
**Phase**: II (Full-Stack Web App)
**Source**: `speckit.specify` (Key Entities, FR-008, FR-009, FR-010, FR-011)
**Status**: Draft

## Entities and Relationships

### 1. `User` Entity

**Description**: Represents a registered user of the application. Stores user authentication details and links to their tasks.

**Table Name**: `users`

**Attributes**:

-   `id` (UUID, Primary Key): Unique identifier for the user. Generated by the database (e.g., `uuid.uuid4()`).
    -   *SQLModel*: `Field(default_factory=uuid.uuid4, primary_key=True)`
-   `email` (String, Unique, Not Null): User's email address. Used for login and must be unique.
    -   *SQLModel*: `Field(index=True, unique=True)`
-   `password_hash` (String, Not Null): Hashed password for secure storage.
    -   *SQLModel*: `Field(max_length=256)`
-   `created_at` (DateTime, Not Null, Default: Current Timestamp): Timestamp when the user account was created.
    -   *SQLModel*: `Field(default_factory=datetime.utcnow, nullable=False)`
-   `updated_at` (DateTime, Not Null, Default: Current Timestamp, On Update: Current Timestamp): Timestamp of the last update to the user record.
    -   *SQLModel*: `Field(default_factory=datetime.utcnow, sa_column_kwargs={"onupdate": datetime.utcnow})`

**Relationships**:

-   One-to-Many with `Task`: A user can have multiple tasks.
    -   *SQLModel*: `tasks: List["Task"] = Relationship(back_populates="owner")`

---

### 2. `Task` Entity

**Description**: Represents a single to-do item belonging to a `User`.

**Table Name**: `tasks`

**Attributes**:

-   `id` (UUID, Primary Key): Unique identifier for the task. Generated by the database.
    -   *SQLModel*: `Field(default_factory=uuid.uuid4, primary_key=True)`
-   `description` (String, Not Null): The textual description of the task.
    -   *SQLModel*: `Field(max_length=255)`
-   `status` (String, Not Null, Default: "Pending"): The completion status of the task. Valid values: "Pending", "Complete".
    -   *SQLModel*: `Field(default="Pending", max_length=10)`
-   `user_id` (UUID, Foreign Key): Links the task to its owner (`User`).
    -   *SQLModel*: `Field(foreign_key="users.id", index=True)`
-   `created_at` (DateTime, Not Null, Default: Current Timestamp): Timestamp when the task was created.
    -   *SQLModel*: `Field(default_factory=datetime.utcnow, nullable=False)`
-   `updated_at` (DateTime, Not Null, Default: Current Timestamp, On Update: Current Timestamp): Timestamp of the last update to the task record.
    -   *SQLModel*: `Field(default_factory=datetime.utcnow, sa_column_kwargs={"onupdate": datetime.utcnow})`

**Relationships**:

-   Many-to-One with `User`: A task belongs to one user.
    -   *SQLModel*: `owner: Optional[User] = Relationship(back_populates="tasks")`

## Database

**Type**: Neon Serverless PostgreSQL
**Connectivity**: Managed via SQLModel's SQLAlchemy engine configuration.

## ORM Details (SQLModel)

-   All entities will inherit from `SQLModel`.
-   UUIDs will be used for primary keys (`id`) to ensure global uniqueness and prevent sequential ID exposure.
-   `created_at` and `updated_at` fields will automatically manage timestamps for auditing.
-   Relationships between `User` and `Task` will be defined using `Relationship` objects for easy querying.
